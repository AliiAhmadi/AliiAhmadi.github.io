<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Resolving A DNS Issue</title><meta content="Ali Ahmadi" name=author><meta content="Resolving my DNS issue." name=description><meta content=AliAhmadi2004.ir property=og:site_name><meta content=en-us property=og:locale><meta content=https://AliAhmadi2004.ir/posts/resolving-a-dns-issue/ property=og:url><meta content="Resolving A DNS Issue" property=og:title><meta content="Resolving my DNS issue." property=og:description><meta content=article property=og:type><meta content="Ali Ahmadi" property=og:article:author><meta content=2018-06-24T13:21:00-07:00 property=og:article:published_time><meta content=Posts property=og:article:section><meta content=DNS property=og:article:tag><meta content=HTTP property=og:article:tag><meta content=Slow property=og:article:tag><meta content=Internet property=og:article:tag><link href=https://fonts.googleapis.com/ rel=dns-prefetch><link href=/site.css rel=stylesheet><link rel="shortcut icon" href=/favicon.svg type=image/svg+xml><link href=https://AliAhmadi2004.ir/posts/resolving-a-dns-issue/ rel=canonical><body><div class=center><img alt=Me src=/self.jpg width=100></div><main><article id=content><header><h1>Resolving A DNS Issue</h1><div class=post-meta><time datetime=2018-06-24T13:21:00-07:00>2018-06-24</time><span class=accent> ⬡ </span><a href=https://AliAhmadi2004.ir/tags/dns/>#DNS</a>, <a href=https://AliAhmadi2004.ir/tags/http/>#HTTP</a>, <a href=https://AliAhmadi2004.ir/tags/slow/>#Slow</a>, <a href=https://AliAhmadi2004.ir/tags/internet/>#Internet</a></div></header><p>Haha. Get it? <em>Resolving</em> a DNS issue. OK, that was bad. You don't have to read anymore, but I'm <code>SOA</code> into this. You might even say I'm in the zone. I think it's gonna be <code>A</code> great read, so consider sticking around, 'cuz there's no TLD;R.</p><span id=continue-reading></span><h2 id=symptoms><a aria-label="Anchor link for: symptoms" href=#symptoms></a>Symptoms</h2><p>A few months ago I switched ISPs to try to support a smaller regional ISP instead of one of the <a href=https://en.wikipedia.org/wiki/Comcast>monopolistic</a> <a href=https://en.wikipedia.org/wiki/WarnerMedia>behemoths</a>. The transition was largely pain free, but after a little while I noticed that something wasn't right on the new network. Periodically my web browsing would be much slower, but it didn't seem to be specific to any particular site. Furthermore, reloading a site I was having a problem with was usually without issue.<p>I let this go on for longer than I'm comfortable admitting, but finally got fed up when I was trying to <code>curl</code> pages from the same site in a loop. I noticed that the same pages took different amounts of time to fetch between runs of the loop, which seemed very wrong to me since they were static pages.<h2 id=troubleshooting><a aria-label="Anchor link for: troubleshooting" href=#troubleshooting></a>Troubleshooting</h2><p>My first step in narrowing down the problem was to pick a website known for its speed and reliability see if I had problems there. I <code>curl</code>ed <a href=https://google.com/>google.com</a> in a loop every 10 seconds and sure enough, every so often the problem would happen there too. The connection would just hang for a few seconds, but eventually complete.<p>Next, I wondered how I could narrow it down further to make sure the issue wasn't caused on my home network. Then I remembered that my gateway could be accessed by its IP of <a href=https://192.168.1.1>192.168.1.1</a> and the hostname <a href=https://router.asus.com>router.asus.com</a>. I pointed <code>curl</code> at my router's hostname. The same problem was happening with a domain that resolved to my local network!<p>OK, so it didn't matter whether I was leaving my network or not. Traffic was <em>slooow</em> either way. I changed my <code>curl</code> loop to point at my router by its IP. No issues whatsoever. At this point I recalled the age-old sysadmin wisdom. It's <strong>always</strong> DNS!<figure><img alt="It's Always DNS" src=its-always-dns.svg><figcaption>It's Always DNS. Converted to SVG from a <a href=https://www.reddit.com/r/sysadmin/comments/34ag51/its_always_dns/>Reddit post</a> by <a href=https://www.reddit.com/u/tehrabbitt>u/tehrabbitt</a>. <a href=its-always-dns.svg>View full size.</a></figcaption></figure><h2 id=gathering-data><a aria-label="Anchor link for: gathering-data" href=#gathering-data></a>Gathering Data</h2><p>Clearly this was an intermittent DNS issue. I could have gone right into fixing the problem, but I wanted to know just how bad it was. In order to do that I needed data. I collected timing information for simultaneous HTTP GET requests resolving by IP address and by hostname for the same domain over a 2 hour period with the help of this script.<pre class=language-zsh data-lang=zsh style=background:#282828;color:#fdf4c1aa><code class=language-zsh data-lang=zsh><span style=font-style:italic;color:#928374>#!/usr/bin/env zsh
</span><span>
</span><span style=font-style:italic;color:#928374># 720 * 10s = 2hrs
</span><span style=color:#fabd2f>: </span><span style=color:#fdf4c1>${INTERVAL</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>10}
</span><span style=color:#fabd2f>: </span><span style=color:#fdf4c1>${NUM_TESTS</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>720}
</span><span>
</span><span style=color:#fabd2f>: </span><span style=color:#fdf4c1>${ROUTER_IP</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"192.168.1.1"</span><span style=color:#fdf4c1>}
</span><span style=color:#fabd2f>: </span><span style=color:#fdf4c1>${ROUTER_HOSTNAME</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"router.asus.com"</span><span style=color:#fdf4c1>}
</span><span>
</span><span style=color:#fabd2f>: </span><span style=color:#fdf4c1>${OUTPUT_FILE</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"./http-test-results.csv"</span><span style=color:#fdf4c1>}
</span><span>
</span><span style=color:#fa5c4b>function </span><span style=color:#8ec07c>now</span><span>() {
</span><span>    </span><span style=font-style:italic;color:#928374># ISO 8601 FTW!
</span><span>    </span><span style=color:#fdf4c1>date -u </span><span style=color:#b8bb26>"+%Y-%m-%dT%H:%M:%SZ"
</span><span>}
</span><span>
</span><span style=color:#fa5c4b>function </span><span style=color:#8ec07c>http-test</span><span>() {
</span><span style=color:#fdf4c1>    </span><span style=color:#fa5c4b>local </span><span style=color:#fdf4c1>host</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>$</span><span style=color:#fdf4c1>1
</span><span>    </span><span style=color:#fdf4c1>/usr/bin/time -f </span><span style=color:#b8bb26>"%e"</span><span style=color:#fdf4c1> curl -s $host </span><span style=color:#fe8019>></span><span style=color:#fdf4c1> /dev/null
</span><span>}
</span><span>
</span><span style=color:#fa5c4b>function </span><span style=color:#8ec07c>run-tests</span><span>() {
</span><span>    </span><span style=font-style:italic;color:#928374># Create CSV header.
</span><span>    </span><span style=color:#fabd2f>echo </span><span style=color:#b8bb26>"Datetime,Seconds for HTTP GET by IP,Seconds for HTTP GET by Hostname"
</span><span>
</span><span>    </span><span style=font-style:italic;color:#928374># A sample CSV row will look like
</span><span>    </span><span style=font-style:italic;color:#928374># 2018-03-26T03:37:29Z,0.01,0.02
</span><span>
</span><span>    </span><span style=font-style:italic;color:#928374># For each iteration spit out the current time, how long it takes to curl
</span><span>    </span><span style=font-style:italic;color:#928374># with an IP address, and how long it takes to curl with a hostname.
</span><span>    </span><span style=color:#fa5c4b>for</span><span> t </span><span style=color:#fa5c4b>in </span><span>{1..${</span><span style=color:#fdf4c1>NUM_TESTS</span><span>}}
</span><span>    </span><span style=color:#fa5c4b>do
</span><span>        </span><span style=font-style:italic;color:#928374># Redirect stderr to stdout with 2>&1 to capture GNU time's output.
</span><span>        </span><span style=color:#fabd2f>echo </span><span style=color:#b8bb26>"$(</span><span style=color:#fdf4c1>now</span><span style=color:#b8bb26>),$(</span><span style=color:#fdf4c1>http-test ${ROUTER_IP} </span><span style=color:#d3869b>2</span><span style=color:#fe8019>>&</span><span style=color:#d3869b>1</span><span style=color:#b8bb26>),$(</span><span style=color:#fdf4c1>http-test ${ROUTER_HOSTNAME} </span><span style=color:#d3869b>2</span><span style=color:#fe8019>>&</span><span style=color:#d3869b>1</span><span style=color:#b8bb26>)"
</span><span>        </span><span style=color:#fdf4c1>sleep ${INTERVAL}
</span><span>    </span><span style=color:#fa5c4b>done
</span><span>}
</span><span>
</span><span style=color:#fdf4c1>run-tests </span><span style=color:#fe8019>>> </span><span style=color:#fdf4c1>${OUTPUT_FILE}
</span></code></pre><p>That was going to give me the data I needed, but reading raw CSVs is a pain. I don't do graphing very often, but I figured visualization would help, so I did a quick survey of Python graphing libraries and found the <a href=https://github.com/Kozea/pygal>Pygal</a> library. It turned out to be much more flexible than Matplotlib for my needs and gave me great looking SVGs customized to match the style of this site.<pre class=language-python data-lang=python style=background:#282828;color:#fdf4c1aa><code class=language-python data-lang=python><span style=font-style:italic;color:#928374>#!/usr/bin/env python3.6
</span><span>
</span><span style=color:#fa5c4b>import </span><span>sys
</span><span style=color:#fa5c4b>from </span><span>typing </span><span style=color:#fa5c4b>import </span><span>Iterator
</span><span>
</span><span style=color:#fa5c4b>import </span><span>pandas </span><span style=color:#fa5c4b>as </span><span>pd
</span><span style=color:#fa5c4b>from </span><span>pygal </span><span style=color:#fa5c4b>import </span><span>Line
</span><span style=color:#fa5c4b>from </span><span>pygal.style </span><span style=color:#fa5c4b>import </span><span>Style
</span><span>
</span><span>
</span><span style=color:#fa5c4b>class </span><span style=color:#8ec07c>GruvboxStyle</span><span>(</span><span style=color:#8ec07c>Style</span><span>):
</span><span>    </span><span style=font-style:italic;color:#928374>""" A gruvbox-inspired Pygal style. """
</span><span>
</span><span>    background </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>'#282828'
</span><span>    plot_background </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>'#1d2021'
</span><span>    foreground </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>'#fdf4c1'
</span><span>    foreground_strong </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>'#fdf4c1'
</span><span>    foreground_subtle </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>'#fdf4c1'
</span><span>    colors </span><span style=color:#fe8019>= </span><span>(</span><span style=color:#b8bb26>'#8ec07c'</span><span>, </span><span style=color:#b8bb26>'#fa5c4b'</span><span>)
</span><span>
</span><span>
</span><span style=color:#fa5c4b>def </span><span style=color:#8ec07c>dilute_datetimes</span><span>(</span><span style=color:#fdf4c1>datetimes</span><span>: pd.Series, </span><span style=color:#fdf4c1>factor</span><span>: </span><span style=color:#fabd2f>int</span><span>) -> Iterator[</span><span style=color:#fabd2f>str</span><span>]:
</span><span>    </span><span style=font-style:italic;color:#928374>""" Lots of datetimes overlap and become unreadable, make some space. """
</span><span>    dilute </span><span style=color:#fe8019>= </span><span style=color:#fa5c4b>lambda </span><span style=color:#fdf4c1>t</span><span>: t[</span><span style=color:#d3869b>1</span><span>] </span><span style=color:#fa5c4b>if </span><span>t[</span><span style=color:#d3869b>0</span><span>] </span><span style=color:#fe8019>% </span><span>factor </span><span style=color:#fe8019>== </span><span style=color:#d3869b>0 </span><span style=color:#fa5c4b>else </span><span style=color:#b8bb26>''
</span><span>    </span><span style=color:#fa5c4b>yield from </span><span style=color:#fabd2f>map</span><span style=color:#fdf4c1>(dilute, </span><span style=color:#fabd2f>enumerate</span><span style=color:#fdf4c1>(datetimes))
</span><span>
</span><span>
</span><span style=color:#fa5c4b>def </span><span style=color:#8ec07c>generate_chart</span><span>(</span><span style=color:#fdf4c1>data</span><span>: pd.DataFrame) -> Line:
</span><span>    line_chart </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>Line(
</span><span style=color:#fdf4c1>        js</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>(),  </span><span style=font-style:italic;color:#928374># The tooltips are really nice, but I don't want any JS.
</span><span style=color:#fdf4c1>        style</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>GruvboxStyle,
</span><span style=color:#fdf4c1>        x_label_rotation</span><span style=color:#fe8019>=</span><span style=color:#d3869b>30
</span><span style=color:#fdf4c1>    )
</span><span>
</span><span>    </span><span style=font-style:italic;color:#928374># Water those datetimes down so they don't overlap and we can read them!
</span><span>    datetimes </span><span style=color:#fe8019>= </span><span>data[</span><span style=color:#b8bb26>'Datetime'</span><span>]
</span><span>    dilution_factor </span><span style=color:#fe8019>= </span><span>datetimes.shape[</span><span style=color:#d3869b>0</span><span>] </span><span style=color:#fe8019>// </span><span style=color:#d3869b>10
</span><span>    datetimes </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>dilute_datetimes(datetimes, factor</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>dilution_factor)
</span><span>
</span><span>    line_chart.title </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>'HTTP GET by IP vs. HTTP GET by Hostname'
</span><span>    line_chart.y_title </span><span style=color:#fe8019>= </span><span style=color:#b8bb26>'Seconds'
</span><span>    line_chart.x_labels </span><span style=color:#fe8019>= </span><span>datetimes
</span><span>    </span><span style=color:#fdf4c1>line_chart.add(
</span><span style=color:#fdf4c1>        title</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>'By IP'</span><span style=color:#fdf4c1>,
</span><span style=color:#fdf4c1>        values</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>data[</span><span style=color:#b8bb26>'Seconds for HTTP GET by IP'</span><span style=color:#fdf4c1>]
</span><span style=color:#fdf4c1>    )
</span><span>    </span><span style=color:#fdf4c1>line_chart.add(
</span><span style=color:#fdf4c1>        title</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>'By Hostname'</span><span style=color:#fdf4c1>,
</span><span style=color:#fdf4c1>        values</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>data[</span><span style=color:#b8bb26>'Seconds for HTTP GET by Hostname'</span><span style=color:#fdf4c1>]
</span><span style=color:#fdf4c1>    )
</span><span>    </span><span style=color:#fa5c4b>return </span><span>line_chart
</span><span>
</span><span>
</span><span style=color:#fa5c4b>def </span><span style=color:#8ec07c>main</span><span>(</span><span style=color:#fdf4c1>argv</span><span>: </span><span style=color:#fabd2f>list</span><span>) -> </span><span style=color:#d3869b>None</span><span>:
</span><span>    data </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>pd.read_csv(sys.argv[</span><span style=color:#d3869b>1</span><span style=color:#fdf4c1>])
</span><span>    output </span><span style=color:#fe8019>= </span><span>sys.argv[</span><span style=color:#d3869b>2</span><span>]
</span><span>    chart </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>generate_chart(data)
</span><span>    </span><span style=color:#fdf4c1>chart.render_to_file(output)
</span><span>
</span><span>
</span><span style=color:#fa5c4b>if </span><span style=color:#fabd2f>__name__ </span><span style=color:#fe8019>== </span><span style=color:#b8bb26>'__main__'</span><span>:
</span><span>    </span><span style=color:#fdf4c1>main(sys.argv)
</span></code></pre><p>Now I could run a few simple commands and get a chart to help me understand what I was dealing with.<pre class=language-zsh data-lang=zsh style=background:#282828;color:#fdf4c1aa><code class=language-zsh data-lang=zsh><span style=font-style:italic;color:#928374>#!/usr/bin/env zsh
</span><span style=color:#fa5c4b>export </span><span style=color:#fdf4c1>OUTPUT_FILE</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>before.csv
</span><span style=color:#fdf4c1>zsh http-test.zsh </span><span style=color:#fe8019>&& </span><span style=color:#fdf4c1>python3.6 chart.py $OUTPUT_FILE ${OUTPUT_FILE</span><span style=color:#fe8019>:</span><span style=color:#fdf4c1>r}.svg
</span></code></pre><p>I ended up truncating the results for the graphs below to only show 30 minutes of the 2 hour data to help readability, but the data looks just about the same anyway.<figure><img alt="HTTP GET by IP vs. HTTP GET by Hostname Before the Fix" src=before.svg><figcaption>HTTP GET by IP vs. HTTP GET by Hostname before the fix. <a href=before.svg>View full size.</a></figcaption></figure><p><strong>Wow!</strong> That's <em>really</em> bad. You can't even see the <em>By IP</em> series because it's dwarfed by these enormous outliers from <em>By Hostname</em>. These were local DNS requests. There's no reason they should have been taking <strong>greater than 5 seconds</strong> to complete.<h2 id=resolution><a aria-label="Anchor link for: resolution" href=#resolution></a>Resolution</h2><p>I logged into my router's administrative console and sure enough, right there in the logs was a DNS error.<pre style=background:#282828;color:#fdf4c1aa><code><span>Mar 25 21:44:03 dnsmasq[31700]: nameserver 208.76.152.1 refused to do a recursive query
</span></code></pre><p>I was still using the default upstream DNS given by my ISP and it was refusing <a href=https://unix.stackexchange.com/a/24391/82338>recursive DNS queries</a>. My OS wasn't running a caching DNS resolver locally, so I was totally at the mercy of my router. When the router went out to lunch trying to satisfy a DNS request my connections did too.<p>Curiously, only one of the two nameservers my router was configured to use appeared in the logs with that error message. Not knowing exactly how the router manufacturer configured DNSMasq or how the upstream DNS servers were configured my working hypothesis is that the one refusing recursive queries was the primary and requests that weren't cached always had to go to two servers.<p>My assumption is that DNSMasq is pretty badly misconfigured on my router as I wouldn't expect <a href=https://router.asus.com>router.asus.com</a> to even need a recursive query. Ultimately I should probably run my own local DNS. Maybe I'll even take <a href=https://github.com/bluejekyll/trust-dns>trust-dns</a> for a spin. That would be a long-term project though, so I opted instead to simply change my nameservers to <a href=https://developers.google.com/speed/public-dns/>Google's public ones</a>. The problem finally went away once recursive queries were being supported!<h2 id=measuring-success><a aria-label="Anchor link for: measuring-success" href=#measuring-success></a>Measuring Success</h2><p>Once I was confident I'd fixed the problem I ran the same chart generation commands as before, being careful to set <code>OUTPUT_FILE="after.csv"</code> so as not to overwrite my previous data.<figure><img alt="HTTP GET by IP vs. HTTP GET by Hostname After the Fix" src=after.svg><figcaption>HTTP GET by IP vs. HTTP GET by Hostname after the fix. <a href=after.svg>View full size.</a></figcaption></figure><p>Much better! Even the most extreme request was under two tenths of a second. Just how much did the situation improve though? I wrote one last script to find out.<pre class=language-zsh data-lang=zsh style=background:#282828;color:#fdf4c1aa><code class=language-zsh data-lang=zsh><span style=font-style:italic;color:#928374>#!/usr/bin/env zsh
</span><span style=color:#fa5c4b>function </span><span style=color:#8ec07c>percent_failures</span><span>() {
</span><span style=color:#fdf4c1>    </span><span style=color:#fa5c4b>local </span><span style=color:#fdf4c1>file</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"${</span><span style=color:#fdf4c1>1</span><span style=color:#b8bb26>}"
</span><span style=color:#fdf4c1>    </span><span style=color:#fa5c4b>local </span><span style=color:#fdf4c1>pattern</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"${</span><span style=color:#fdf4c1>2</span><span style=color:#b8bb26>}"
</span><span style=color:#fdf4c1>    </span><span style=color:#fa5c4b>local </span><span style=color:#fdf4c1>num_failures</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>$(</span><span style=color:#fdf4c1>grep $pattern $file </span><span style=color:#fe8019>| </span><span style=color:#fdf4c1>wc -l</span><span style=color:#b8bb26>)
</span><span style=color:#fdf4c1>    </span><span style=color:#fa5c4b>local </span><span style=color:#fdf4c1>num_results</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>$(</span><span style=color:#fdf4c1>wc -l $file </span><span style=color:#fe8019>| </span><span style=color:#fdf4c1>cut -d</span><span style=color:#b8bb26>\ </span><span style=color:#fdf4c1> -f1</span><span style=color:#b8bb26>)
</span><span>    </span><span style=color:#fabd2f>echo </span><span style=color:#b8bb26>"scale=4; ${</span><span style=color:#fdf4c1>num_failures</span><span style=color:#b8bb26>} / ${</span><span style=color:#fdf4c1>num_results</span><span style=color:#b8bb26>} * 100" </span><span style=color:#fe8019>| </span><span style=color:#fdf4c1>bc -l
</span><span>}
</span><span>
</span><span style=color:#fdf4c1>percent_failures before.csv </span><span style=color:#b8bb26>'5\.'
</span><span style=color:#fdf4c1>percent_failures after.csv </span><span style=color:#b8bb26>'5\.'
</span></code></pre><p>Prior to fixing the issue 11.66% of all requests took longer than 5 seconds. After applying the fix that dropped to 0.13%. I'd say that's a noticeable improvement!<h4 id=bonus><a aria-label="Anchor link for: bonus" href=#bonus></a>Bonus</h4><p>In case you were curious about how the <a href=https://AliAhmadi2004.ir/posts/resolving-a-dns-issue/its-always-dns.svg><em>It's Always DNS</em></a> diagram above was generated, here's the <a href=https://www.graphviz.org/>Graphviz</a> source and <code>dot</code> command to reproduce it.<pre class=language-dot data-lang=dot style=background:#282828;color:#fdf4c1aa><code class=language-dot data-lang=dot><span style=font-style:italic;color:#928374>// File: its-always-dns.dot
</span><span>
</span><span style=color:#fa5c4b>digraph </span><span style=color:#8ec07c>G </span><span>{
</span><span>    </span><span style=color:#fa5c4b>graph </span><span>[ splines</span><span style=color:#fe8019>=</span><span>ortho </span><span style=color:#fabd2f>nodesep</span><span style=color:#fe8019>=</span><span>2 </span><span style=color:#fabd2f>fontcolor</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"#fdf4c1" </span><span>];
</span><span>    </span><span style=color:#fa5c4b>node </span><span>[ </span><span style=color:#fabd2f>style</span><span style=color:#fe8019>=</span><span>filled </span><span style=color:#fabd2f>color</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"#282828" </span><span style=color:#fabd2f>fillcolor</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"#282828"</span><span>, </span><span style=color:#fabd2f>fontcolor</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"#fdf4c1" </span><span>];
</span><span>    </span><span style=color:#fa5c4b>edge </span><span>[ </span><span style=color:#fabd2f>color</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"#282828" </span><span style=color:#fabd2f>fontcolor</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"#282828" </span><span>];
</span><span>
</span><span>    is_it_dns [</span><span style=color:#fabd2f>shape</span><span style=color:#fe8019>=</span><span>diamond </span><span style=color:#fabd2f>label</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"Is it DNS?"</span><span>];
</span><span>    check_bad_records [</span><span style=color:#fabd2f>shape</span><span style=color:#fe8019>=</span><span>box </span><span style=color:#fabd2f>label</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"Check DNS for Bad Records"</span><span>];
</span><span>    is_it_resolved [</span><span style=color:#fabd2f>shape</span><span style=color:#fe8019>=</span><span>diamond </span><span style=color:#fabd2f>label</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"Is the Issue Resolved?"</span><span>];
</span><span>    you_missed_something [</span><span style=color:#fabd2f>shape</span><span style=color:#fe8019>=</span><span>box </span><span style=color:#fabd2f>label</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"You Obviously Missed Something"</span><span>];
</span><span>    its_always_dns [</span><span style=color:#fabd2f>shape</span><span style=color:#fe8019>=</span><span>box </span><span style=color:#fabd2f>label</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"It's Always DNS"</span><span>];
</span><span>
</span><span>    is_it_dns -> check_bad_records [xlabel</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"Yes"</span><span>];
</span><span>    check_bad_records -> is_it_resolved;
</span><span>    is_it_resolved -> its_always_dns [xlabel</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"Yes"</span><span>];
</span><span>    is_it_resolved -> you_missed_something [xlabel</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"No"</span><span>];
</span><span>    you_missed_something -> check_bad_records;
</span><span>    you_missed_something -> is_it_dns [xlabel</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"No"</span><span>];
</span><span>}
</span></code></pre><pre class=language-zsh data-lang=zsh style=background:#282828;color:#fdf4c1aa><code class=language-zsh data-lang=zsh><span style=font-style:italic;color:#928374>#!/usr/bin/env zsh
</span><span style=color:#fdf4c1>dot -Tsvg its-always-dns.dot -o its-always-dns.svg
</span></code></pre><p>In the interest of making this post maximally reproducible I've put all the raw data and scripts used in this post in a <a href=https://github.com/reillysiemens/resolving-a-dns-issue>GitHub repo</a> for anyone who wants to play with them on their own network.</article></main><footer><nav><a href=/>Home</a> ⬡ <a href=/posts>Posts</a> ⬡ <a href=/tags>Tags</a> ⬡ <a href=/contact>Contact</a></nav><p>© 2024 Ali Ahmadi ⬡ <a href=https://github.com/AliiAhmadi>Github</a></footer>