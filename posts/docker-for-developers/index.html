<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Docker for developers</title><meta content="Ali Ahmadi" name=author><meta content="Learn how to setup a docker environment for development" name=description><meta content=lexurr.ir property=og:site_name><meta content=en-us property=og:locale><meta content=https://lexurr.ir/posts/docker-for-developers/ property=og:url><meta content="Docker for developers" property=og:title><meta content="Learn how to setup a docker environment for development" property=og:description><meta content=article property=og:type><meta content="Ali Ahmadi" property=og:article:author><meta content=2024-02-08T00:00:00-08:00 property=og:article:published_time><meta content=Posts property=og:article:section><meta content=Docker property=og:article:tag><meta content=Golang property=og:article:tag><meta content=Swarm property=og:article:tag><link href=https://fonts.googleapis.com/ rel=dns-prefetch><link href=/site.css rel=stylesheet><link rel="shortcut icon" href=/favicon.svg type=image/svg+xml><link href=https://lexurr.ir/posts/docker-for-developers/ rel=canonical><body><main><article id=content><header><h1>Docker for developers</h1><div class=post-meta><time datetime=2024-02-08T00:00:00-08:00>2024-02-08</time><span class=accent> ‚¨° </span><a href=https://lexurr.ir/tags/docker/>#Docker</a>, <a href=https://lexurr.ir/tags/golang/>#Golang</a>, <a href=https://lexurr.ir/tags/swarm/>#Swarm</a></div></header><p>The first step to start learning docker is to distinguish two word, <code>image</code> and <code>container</code>. By knowing them you can go deeper and learn some useful command to work with docker in your projects for development and also use it for easy deployment. Docker also has some advance concepts like <code>Docker Swarm</code> that it is an orchestration tool. You will also learn some basic knowledge about it in this post.</p><span id=continue-reading></span><div class=image-container><img alt="docker logo" class=resizable-image src=docker-logo.png></div><h2 id=introduction><a aria-label="Anchor link for: introduction" href=#introduction></a>Introduction</h2><p><a href=https://www.docker.com/ rel=noopener target=_blank>Docker</a> is one of the most important tools in the world of software engineering. If you transfer the code written on your laptop to another laptop, you may face problems such as the absence of required tools and dependencies, and probably your solution is to install all the required items, but there is another problem, and that is that you may need packages and frameworks in different versions for different applications, in this case managing different versions and using the correct version will be a problem. This is one of the problems that <a href=https://www.docker.com/ rel=noopener target=_blank>docker</a> will solve for us. <a href=https://www.docker.com/ rel=noopener target=_blank>Docker</a> solves the problem of dependencies by creating an isolated environment that has a separate <a href=https://en.wikipedia.org/wiki/Kernel_(operating_system) rel=noopener target=_blank>kernel</a> from our main operating system for each running application. Also, unlike <a href=https://www.ibm.com/topics/virtualization rel=noopener target=_blank>virtualization</a>, in docker every isolated environment called a <a href=https://www.ionos.com/digitalguide/server/know-how/docker-container/ rel=noopener target=_blank>container</a>, if a common dependency with other containers, there is no need to copy it in a new container and it can use the same one.<p>Well, to start working with Docker, you need to install it first. You can go <a href=https://docs.docker.com/get-docker/ rel=noopener target=_blank>here</a> to download Docker according to your operating system and hardware. Docker has a very long history, which we will not discuss here, so we will go directly to working with Docker. For the first step, you need to pull a Docker image from a Docker registry (we use the official Docker registry (Docker <a href=https://hub.docker.com/ rel=noopener target=_blank>Hub</a>)). We will use official <a href=https://hub.docker.com/_/redis rel=noopener target=_blank>Redis</a> image here. We pull the Redis image with the following command:<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>docker pull redis:latest
</span></code></pre><p>Wait until all image layers are downloaded. After that, you can check the available images with the following command:<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>docker images
</span></code></pre><p>or<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>docker image ls
</span></code></pre><p>You should see a table like the one below but just one row:<div class=image-container><table><thead><tr><th style=text-align:center>REPOSITORY<th style=text-align:center>TAG<th style=text-align:center>IMAGE ID<th style=text-align:center>CREATED<th style=text-align:center>SIZE<tbody><tr><td style=text-align:center>redis<td style=text-align:center>7.0.15<td style=text-align:center><code>d1241776ca74</code><td style=text-align:center>4 weeks ago<td style=text-align:center><code>130MB</code><tr><td style=text-align:center>redislabs/redisinsight<td style=text-align:center>1.13.1<td style=text-align:center><code>76f704dba29e</code><td style=text-align:center>15 months ago<td style=text-align:center><code>1.15GB</code><tr><td style=text-align:center>nginx<td style=text-align:center>alpine<td style=text-align:center><code>2b70e4aaac6b</code><td style=text-align:center>3 months ago<td style=text-align:center><code>42.6MB</code><tr><td style=text-align:center>postgres<td style=text-align:center>latest<td style=text-align:center><code>b0b90c1d9579</code><td style=text-align:center>5 weeks ago<td style=text-align:center><code>425MB</code></table></div><p>Now it's time to talk about the difference between image and container. A container is an isolated running application or service, while an image is a template for launching and running a container. The image is actually not a process until we run a container by copying it, at this time it is called a container. If we want to see active and running containers:<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>docker ps
</span></code></pre><p>Likewise, if we want to see all the previous containers that have been stopped, we use the <code>-a</code> flag:<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>docker ps -a
</span></code></pre><p>Now let's bring up a golang container in a practical way and execute some command and code inside it. The first step is to pull the Golang image:<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>docker pull golang:latest
</span></code></pre><p>After it is downloaded, you can see it in your image list. Now we can create a container from this image:<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>docker run -dt --name go golang:latest
</span></code></pre><p>By running this command, you will see a <a href=https://en.wikipedia.org/wiki/SHA-2 rel=noopener target=_blank>SHA256</a> hash in the terminal:<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>9ddf07593a31514d3e3213c9d67024e1ed227ba81d2fd2521a165cf68ce09c3e
</span></code></pre><p>Now, if you check the list of running containers, you will see something like this:<div class=image-container><table><thead><tr><th style=text-align:center>CONTAINER ID<th style=text-align:center>IMAGE<th style=text-align:center>COMMAND<th style=text-align:center>CREATED<th style=text-align:center>STATUS<th style=text-align:center>PORTS<th style=text-align:center>NAMES<tbody><tr><td style=text-align:center><code>9ddf07593a31</code><td style=text-align:center>golang:latest<td style=text-align:center>"bash"<td style=text-align:center>4 minutes ago<td style=text-align:center>Up 4 minutes<td style=text-align:center><td style=text-align:center><code>go</code></table></div><p>From this table, we can understand that a container is running, its <code>ID</code> is written in the first column, and in the second column, we can understand what image this container is made of. In the third column, it shows the initial command of the container. If you are familiar with <code>Dockerfile</code> and its <code>Instructions</code>, you should know that the initial command is determined by <code>CMD</code> or <code>ENTRYPOINT</code>. We can also understand from the ports column that the container we ran did not provide us with any port to access the container from the host.<p>Now we can connect to the container and write a piece of Go code and run it(Instead of the name of the container, you can put an initial part of the ID so that it is clear which container is meant):<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>docker exec -it go bash
</span></code></pre><p>Now we have access to an interactive environment inside the container. To run the Go code, we first need to write the code in a file and save it. (you can use any terminal text editor, even if it was not installed in the container, you can install it, of course, this is not a standard method, and later you can use other methods for We will discuss putting the file inside the container, but for now we will do it this way). I use the following simple code:<pre class=language-go data-lang=go style=background:#282828;color:#fdf4c1aa><code class=language-go data-lang=go><span style=color:#fa5c4b>package </span><span style=color:#fdf4c1>main
</span><span>
</span><span style=color:#fa5c4b>import </span><span>(
</span><span>	</span><span style=color:#b8bb26>"fmt"
</span><span>	</span><span style=color:#b8bb26>"io/ioutil"
</span><span>)
</span><span>
</span><span style=color:#fa5c4b>func </span><span style=color:#8ec07c>writeFile</span><span>(</span><span style=color:#fdf4c1>filename</span><span>, </span><span style=color:#fdf4c1>content </span><span style=color:#fabd2f>string</span><span>) </span><span style=color:#fabd2f>error </span><span>{
</span><span>	</span><span style=color:#fa5c4b>return </span><span style=color:#fdf4c1>ioutil</span><span>.</span><span style=color:#fdf4c1>WriteFile</span><span>(</span><span style=color:#fdf4c1>filename</span><span>, []</span><span style=color:#fabd2f>byte</span><span>(</span><span style=color:#fdf4c1>content</span><span>), </span><span style=color:#d3869b>0644</span><span>)
</span><span>}
</span><span>
</span><span style=color:#fa5c4b>func </span><span style=color:#8ec07c>readFile</span><span>(</span><span style=color:#fdf4c1>filename </span><span style=color:#fabd2f>string</span><span>) (</span><span style=color:#fabd2f>string</span><span>, </span><span style=color:#fabd2f>error</span><span>) {
</span><span>	</span><span style=color:#fdf4c1>data</span><span>, </span><span style=color:#fdf4c1>err </span><span style=color:#fe8019>:= </span><span style=color:#fdf4c1>ioutil</span><span>.</span><span style=color:#fdf4c1>ReadFile</span><span>(</span><span style=color:#fdf4c1>filename</span><span>)
</span><span>	</span><span style=color:#fa5c4b>if </span><span style=color:#fdf4c1>err </span><span style=color:#fe8019>!= </span><span style=color:#d3869b>nil </span><span>{
</span><span>		</span><span style=color:#fa5c4b>return </span><span style=color:#b8bb26>""</span><span>, </span><span style=color:#fdf4c1>err
</span><span>	}
</span><span>	</span><span style=color:#fa5c4b>return </span><span style=color:#fabd2f>string</span><span>(</span><span style=color:#fdf4c1>data</span><span>), </span><span style=color:#d3869b>nil
</span><span>}
</span><span>
</span><span style=color:#fa5c4b>func </span><span style=color:#8ec07c>main</span><span>() {
</span><span>
</span><span>	</span><span style=font-style:italic;color:#928374>// Write to file
</span><span>	</span><span style=color:#fdf4c1>filename </span><span style=color:#fe8019>:= </span><span style=color:#b8bb26>"test.txt"
</span><span>	</span><span style=color:#fdf4c1>content </span><span style=color:#fe8019>:= </span><span style=color:#b8bb26>"This is a test file."
</span><span>	</span><span style=color:#fdf4c1>err </span><span style=color:#fe8019>:= </span><span style=color:#fdf4c1>writeFile</span><span>(</span><span style=color:#fdf4c1>filename</span><span>, </span><span style=color:#fdf4c1>content</span><span>)
</span><span>	</span><span style=color:#fa5c4b>if </span><span style=color:#fdf4c1>err </span><span style=color:#fe8019>!= </span><span style=color:#d3869b>nil </span><span>{
</span><span>		</span><span style=color:#fdf4c1>fmt</span><span>.</span><span style=color:#fdf4c1>Printf</span><span>(</span><span style=color:#b8bb26>"Error writing to file: </span><span style=color:#fdf4c1>%v</span><span style=color:#b8bb26>\n"</span><span>, </span><span style=color:#fdf4c1>err</span><span>)
</span><span>		</span><span style=color:#fa5c4b>return
</span><span>	}
</span><span>	</span><span style=color:#fdf4c1>fmt</span><span>.</span><span style=color:#fdf4c1>Println</span><span>(</span><span style=color:#b8bb26>"File written successfully."</span><span>)
</span><span>
</span><span>	</span><span style=font-style:italic;color:#928374>// Read from file
</span><span>	</span><span style=color:#fdf4c1>readContent</span><span>, </span><span style=color:#fdf4c1>err </span><span style=color:#fe8019>:= </span><span style=color:#fdf4c1>readFile</span><span>(</span><span style=color:#fdf4c1>filename</span><span>)
</span><span>	</span><span style=color:#fa5c4b>if </span><span style=color:#fdf4c1>err </span><span style=color:#fe8019>!= </span><span style=color:#d3869b>nil </span><span>{
</span><span>		</span><span style=color:#fdf4c1>fmt</span><span>.</span><span style=color:#fdf4c1>Printf</span><span>(</span><span style=color:#b8bb26>"Error reading from file: </span><span style=color:#fdf4c1>%v</span><span style=color:#b8bb26>\n"</span><span>, </span><span style=color:#fdf4c1>err</span><span>)
</span><span>		</span><span style=color:#fa5c4b>return
</span><span>	}
</span><span>	</span><span style=color:#fdf4c1>fmt</span><span>.</span><span style=color:#fdf4c1>Printf</span><span>(</span><span style=color:#b8bb26>"File content: </span><span style=color:#fdf4c1>%s</span><span style=color:#b8bb26>\n"</span><span>, </span><span style=color:#fdf4c1>readContent</span><span>)
</span><span>}
</span></code></pre><p>You can run the code from inside the container. But we have to find a better method because in this method the possibility of error is very high and also if the size of the project and the number of files are very large, then copying the files individually into the container is very difficult.<p>I have to summarize one point that you can create custom images by writing <code>Dockerfile</code> and building them. Here are some of the <code>Instructions</code> that you need to write <code>Dockerfile</code>:<pre class=language-diff data-lang=diff style=background:#282828;color:#fdf4c1aa><code class=language-diff data-lang=diff><span style=color:#fa5c4b>- FROM
</span><span style=color:#fa5c4b>- WORKDIR
</span><span style=color:#fa5c4b>- COPY
</span><span style=color:#fa5c4b>- ADD
</span><span style=color:#fa5c4b>- RUN
</span><span style=color:#fa5c4b>- ENV
</span><span style=color:#fa5c4b>- EXPOSE
</span><span style=color:#fa5c4b>- USER
</span><span style=color:#fa5c4b>- CMD
</span><span style=color:#fa5c4b>- ENTRYPOINT
</span></code></pre><p>Unfortunately, there is not enough space here to explain the <code>Dockerfile</code> and its <code>Instructions</code>, but you can refer to the Docker <a href=https://docs.docker.com/engine/reference/builder/ rel=noopener target=_blank>document</a> for reading. Now let's create our own image, which includes the codes we need by default:<pre class=language-Dockerfile data-lang=Dockerfile style=background:#282828;color:#fdf4c1aa><code class=language-Dockerfile data-lang=Dockerfile><span style=font-style:italic;color:#928374>#Base image
</span><span style=color:#fa5c4b>FROM</span><span> golang:</span><span style=color:#8ec07c>latest
</span><span>
</span><span style=color:#fa5c4b>WORKDIR </span><span>/opt/app
</span><span>
</span><span style=color:#fa5c4b>COPY</span><span> . .
</span><span>
</span><span style=color:#fa5c4b>RUN </span><span>go build -o app .
</span><span>
</span><span style=color:#fe8019>CMD </span><span>[</span><span style=color:#b8bb26>"bash"</span><span>]
</span></code></pre><p>If we have the above <code>Dockerfile</code> in the main folder of our project, we can make our image so that our codes are automatically copied into the image. Let me explain the Docker instructions in the above file. In the first instruction, which is <code>FROM</code>, we determine what our initial image should be, which we will make changes to in the future instructions.<p>In the second instruction, <code>WORKDIR</code>, we determine where our starting point is in the file system of the containers that are created from this image. If this folder does not exist, it will be created.<p>The third instruction needs no explanation! Because our <code>Dockerfile</code> is located in the main folder of the project, the entire project is copied into the container and in the <code>WORKDIR</code> location that we specified.<p>In the fourth instruction, we compiled the project code and output it with the name <code>app</code>. In general, we can execute any command on the image with the <code>RUN</code> command. By executing each instruction, we actually add a layer to our image. Unfortunately, there is no place to explain <code>layers</code> and how to optimize them.<p>And finally, with the <code>CMD</code> instruction, we can specify a command that will always be executed when starting the execution of each container from this image (We can change this command when the container starts running).<p>Now we can create our image:<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>docker build -t my-app:1.0.0 .
</span></code></pre><p>But we usually do not do this. Because in most projects we have more than one service, we need several <code>Dockerfiles</code> to create the required images, which would be tedious to do manually. So, we have to write the <code>docker-compose.yml</code> file so that we can start and stop all the services we need at once. Of course, you need to install <code>docker-compose</code> before proceeding.<pre class=language-yaml data-lang=yaml style=background:#282828;color:#fdf4c1aa><code class=language-yaml data-lang=yaml><span style=font-weight:700;color:#8ec07c>version</span><span>: </span><span style=color:#b8bb26>'3'
</span><span>
</span><span style=font-weight:700;color:#8ec07c>services</span><span>:
</span><span>  </span><span style=font-weight:700;color:#8ec07c>go</span><span>:
</span><span>    </span><span style=font-weight:700;color:#8ec07c>build</span><span>: 
</span><span>      </span><span style=font-weight:700;color:#8ec07c>dockerfile</span><span>: </span><span style=color:#b8bb26>Dockerfile
</span><span>      </span><span style=font-weight:700;color:#8ec07c>context</span><span>: </span><span style=color:#d3869b>.
</span><span>    </span><span style=font-weight:700;color:#8ec07c>volumes</span><span>:
</span><span>      - </span><span style=color:#b8bb26>.:/opt/app
</span><span>    </span><span style=font-weight:700;color:#8ec07c>container_name</span><span>: </span><span style=color:#b8bb26>golang-test
</span><span>    </span><span style=font-weight:700;color:#8ec07c>stdin_open</span><span>: </span><span style=color:#d3869b>true
</span><span>    </span><span style=font-weight:700;color:#8ec07c>tty</span><span>: </span><span style=color:#d3869b>true
</span></code></pre><p>The syntax of the file is quite clear, so I will not give an explanation. Let me briefly explain about <code>volumes</code> that we can use them to <code>sync</code> files and data between containers and host machines.<p>Here I defined a <code>volume</code> from the current folder to the folder inside the container where I copied the project codes for easier development. Any change in either side will change the files in the other side and this is very good for when we are developing the project.<p>To run the services defined in the <code>docker-compose.yml</code> file, we must use <code>docker-compose</code>:<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>docker-compose up -d
</span></code></pre><p>And also to stop services at once:<pre class=language-bash data-lang=bash style=background:#282828;color:#fdf4c1aa><code class=language-bash data-lang=bash><span style=color:#fdf4c1>docker-compose down
</span></code></pre><p>Finally, in order to run the project more easily without the need to manually connect to the container and run it, I will write a simple <code>Makefile</code>.<pre class=language-makefile data-lang=makefile style=background:#282828;color:#fdf4c1aa><code class=language-makefile data-lang=makefile><span style=color:#fdf4c1>.DEFAULT_GOAL </span><span style=color:#fe8019>:= </span><span style=color:#b8bb26>run
</span><span>
</span><span style=color:#8ec07c>run</span><span style=color:#fe8019>:
</span><span>	</span><span style=color:#d3869b>@</span><span style=color:#fdf4c1>docker exec -it golang-test go run .
</span><span>
</span><span style=color:#8ec07c>fmt_vet</span><span style=color:#fe8019>:
</span><span>	</span><span style=color:#d3869b>@</span><span style=color:#fdf4c1>docker exec -it golang-test go fmt ./... </span><span style=color:#fe8019>&& </span><span style=color:#fdf4c1>go vet ./...
</span><span>
</span><span style=color:#8ec07c>.PHONY</span><span style=color:#fe8019>: </span><span style=color:#b8bb26>run fmt_vet
</span></code></pre><p>And that's it :)<p>I hope that I will be able to convey more content in the next articles. Thanks for reading ü§ù.<p><img alt=golang src=https://lexurr.ir/posts/docker-for-developers/golang.png></article></main><footer><nav><a href=/>Home</a> ‚¨° <a href=/posts>Posts</a> ‚¨° <a href=/tags>Tags</a> ‚¨° <a href=/contact>Contact</a></nav><p>¬© 2024 Ali Ahmadi ‚¨° <a href=https://github.com/AliiAhmadi>Github</a></footer>