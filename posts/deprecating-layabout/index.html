<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1" name=viewport><title>Deprecating Layabout</title><meta content="Ali Ahmadi" name=author><meta content="Deprecating Layabout" name=description><meta content=AliAhmadi2004.ir property=og:site_name><meta content=en-us property=og:locale><meta content=https://AliAhmadi2004.ir/posts/deprecating-layabout/ property=og:url><meta content="Deprecating Layabout" property=og:title><meta content="Deprecating Layabout" property=og:description><meta content=article property=og:type><meta content="Ali Ahmadi" property=og:article:author><meta content=2019-12-31T17:29:00-08:00 property=og:article:published_time><meta content=Posts property=og:article:section><meta content=Slack property=og:article:tag><meta content=Python property=og:article:tag><meta content=Layabout property=og:article:tag><link href=https://fonts.googleapis.com/ rel=dns-prefetch><link href=/site.css rel=stylesheet><link rel="shortcut icon" href=/favicon.svg type=image/svg+xml><link href=https://AliAhmadi2004.ir/posts/deprecating-layabout/ rel=canonical><body><div class=center><img alt=Me src=/self.jpg width=100></div><main><article id=content><header><h1>Deprecating Layabout</h1><div class=post-meta><time datetime=2019-12-31T17:29:00-08:00>2019-12-31</time><span class=accent> â¬¡ </span><a href=https://AliAhmadi2004.ir/tags/slack/>#Slack</a>, <a href=https://AliAhmadi2004.ir/tags/python/>#Python</a>, <a href=https://AliAhmadi2004.ir/tags/layabout/>#Layabout</a></div></header><p>Since <a href=https://layabout.readthedocs.io/en/latest>Layabout</a> launched last year it has been downloaded 5,755 times, gotten 16 stars on GitHub, been used by a Portuguese startup to teach a <a href=https://github.com/ricardojusto/haskell-workshop/blob/f96aa901700d0b10dad35f391a94017f502fb42a/s01/e10/bot/receive>Haskell workshop</a>, and received a <a href=https://twitter.com/roach/status/1019279698092744705>Twitter shout-out</a> from <a href=https://twitter.com/roach>@roach</a>, one of the core contributors to the <a href=https://github.com/slackapi/python-slackclient>official Python Slack client</a>. During that time the official client library also got a <strong>lot</strong> better! So much better, in fact, that I've decided to deprecate Layabout.</p><span id=continue-reading></span><h2 id=when><a aria-label="Anchor link for: when" href=#when></a>When?</h2><p>Layabout is officially deprecated on <strong>January 1st, 2020</strong> along with Python 2 (<em>finally</em> ðŸ˜‰). I'll be rolling out documentation changes and adding deprecation warnings in a final release within the next week or so. Technically Layabout will continue to function as long as the API interface supported by the 1.0 Slack library is supported, but you should transition off of it as soon as you are able. I recommend using the 2.0 Slack library instead.<h2 id=why><a aria-label="Anchor link for: why" href=#why></a>Why?</h2><p>In May, <a href=https://twitter.com/RodneyU215>Rodney Urquhart</a> and contributors <a href=https://slack.engineering/rewriting-the-slack-python-sdk-ea000f587de7>rewrote the slackclient library</a> from the ground up in a way that closely matched some of the design decisions I made when creating Layabout. When I <a href=/posts/announcing-layabout>announced Layabout</a> I included a quick example of using the framework to build an echo client that would repeat all messages in a given channel. To understand why Layabout no longer provides substantial benefit, let's compare that example written with Layabout to the same application using the 2.0 Slack client.<pre class=language-python data-lang=python style=background:#282828;color:#fdf4c1aa><code class=language-python data-lang=python><span style=font-style:italic;color:#928374>""" An echo client written using Layabout. """
</span><span style=color:#fa5c4b>from </span><span>layabout </span><span style=color:#fa5c4b>import </span><span>Layabout
</span><span>
</span><span>app </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>Layabout()
</span><span>
</span><span>
</span><span>@app.</span><span style=color:#fdf4c1>handle</span><span>(</span><span style=color:#b8bb26>"message"</span><span>)
</span><span style=color:#fa5c4b>def </span><span style=color:#8ec07c>echo</span><span>(</span><span style=color:#fdf4c1>slack</span><span>: </span><span style=color:#b8bb26>"slackclient.SlackClient"</span><span>, </span><span style=color:#fdf4c1>event</span><span>: </span><span style=color:#fabd2f>dict</span><span>) -> </span><span style=color:#d3869b>None</span><span>:
</span><span>    </span><span style=font-style:italic;color:#928374>""" Echo all messages seen by the app except our own. """
</span><span>    </span><span style=color:#fa5c4b>if </span><span style=color:#fdf4c1>event.get(</span><span style=color:#b8bb26>"subtype"</span><span style=color:#fdf4c1>) </span><span style=color:#fe8019>!= </span><span style=color:#b8bb26>"bot_message"</span><span>:
</span><span>        </span><span style=color:#fdf4c1>slack.rtm_send_message(event[</span><span style=color:#b8bb26>"channel"</span><span style=color:#fdf4c1>], event[</span><span style=color:#b8bb26>"text"</span><span style=color:#fdf4c1>])
</span><span>
</span><span>
</span><span style=color:#fa5c4b>if </span><span style=color:#fabd2f>__name__ </span><span style=color:#fe8019>== </span><span style=color:#b8bb26>"__main__"</span><span>:
</span><span>    </span><span style=color:#fdf4c1>app.run()
</span></code></pre><pre class=language-python data-lang=python style=background:#282828;color:#fdf4c1aa><code class=language-python data-lang=python><span style=font-style:italic;color:#928374>""" An echo client written using the official slackclient library. """
</span><span style=color:#fa5c4b>import </span><span>os
</span><span style=color:#fa5c4b>from </span><span>slack </span><span style=color:#fa5c4b>import </span><span>RTMClient
</span><span>
</span><span>
</span><span>@RTMClient.</span><span style=color:#fdf4c1>run_on</span><span>(</span><span style=color:#fdf4c1>event</span><span style=color:#fe8019>=</span><span style=color:#b8bb26>"message"</span><span>)
</span><span style=color:#fa5c4b>async def </span><span style=color:#8ec07c>echo</span><span>(</span><span style=color:#fe8019>**</span><span style=color:#fdf4c1>payload</span><span>) -> </span><span style=color:#d3869b>None</span><span>:
</span><span>    </span><span style=font-style:italic;color:#928374>""" Echo all messages seen by the app except our own. """
</span><span>    data </span><span style=color:#fe8019>= </span><span>payload[</span><span style=color:#b8bb26>"data"</span><span>]
</span><span>    web_client </span><span style=color:#fe8019>= </span><span>payload[</span><span style=color:#b8bb26>"web_client"</span><span>]
</span><span>
</span><span>    </span><span style=color:#fa5c4b>if </span><span>data[</span><span style=color:#b8bb26>"subtype"</span><span>] </span><span style=color:#fe8019>!= </span><span style=color:#b8bb26>"bot_message"</span><span>:
</span><span>        </span><span style=color:#fdf4c1>web_client.chat_postMessage(
</span><span style=color:#fdf4c1>            channel</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>data[</span><span style=color:#b8bb26>"channel"</span><span style=color:#fdf4c1>], text</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>data[</span><span style=color:#b8bb26>"text"</span><span style=color:#fdf4c1>], thread_ts</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>data[</span><span style=color:#b8bb26>"thread_ts"</span><span style=color:#fdf4c1>]
</span><span style=color:#fdf4c1>        )
</span><span>
</span><span>
</span><span style=color:#fa5c4b>if </span><span style=color:#fabd2f>__name__ </span><span style=color:#fe8019>== </span><span style=color:#b8bb26>"__main__"</span><span>:
</span><span>    slack_token </span><span style=color:#fe8019>= </span><span>os.environ[</span><span style=color:#b8bb26>"SLACK_API_TOKEN"</span><span>]
</span><span>    rtm_client </span><span style=color:#fe8019>= </span><span style=color:#fdf4c1>RTMClient(token</span><span style=color:#fe8019>=</span><span style=color:#fdf4c1>slack_token)
</span><span>    </span><span style=color:#fdf4c1>rtm_client.start()
</span></code></pre><p>The Layabout example is a little more terse, but neither is a lot of code. They both leverage a decorator pattern for callback registration and support type annotations. The official library also adds <code>async</code> support. It should be relatively straightforward to translate a Layabout application to using the offical library.<h3 id=event-oriented-decorator-api><a aria-label="Anchor link for: event-oriented-decorator-api" href=#event-oriented-decorator-api></a>Event-oriented decorator API</h3><p>At the time that I wrote Layabout, the slackclient library provided more of a low-level API, so Layabout functioned as a refinement on reading from the WebSocket connection in a loop. It seems Rodney and I both agreed that the decorator pattern is much more convenient for callback registry. The only important thing that the official library does differently is give you a <code>payload</code> dictionary rather than individual arguments. Both a <code>slack</code> instance and an <code>event</code> are included in that <code>payload</code>, so this is a minor change.<h3 id=async><a aria-label="Anchor link for: async" href=#async></a>Async</h3><p>The rewrite of the slackclient library brought with it clever, optional support for <a href=https://www.python.org/dev/peps/pep-0492/>Python's <code>async</code>/<code>await</code> syntax</a>. At the time I was writing Layabout I wanted to add support for that myself, but the only available API was synchronous. Interacting with the Slack API via WebSockets lends itself naturally to an asynchonous approach. In my opinion, using the offical library will give a big advantage over Layabout here. If you've structured your Layabout callbacks well and haven't done necessarily synchronous operations, then you should be fine here.<h3 id=type-annotations><a aria-label="Anchor link for: type-annotations" href=#type-annotations></a>Type annotations</h3><p>Like Layabout, the slackclient library now has <a href=https://www.python.org/dev/peps/pep-0484/>type annotations</a>, which I think are a fantastic addition to Python. If you choose to add a type checker like <a href=http://mypy-lang.org/>mypy</a> or <a href=https://pyre-check.org/>Pyre</a> to your toolkit, you can get the benefit of optional static analysis. Layabout no longer provides an extra service since this is supported by the slackclient library directly.<h2 id=what-s-missing><a aria-label="Anchor link for: what-s-missing" href=#what-s-missing></a>What's Missing?</h2><p>There are three main pieces of functionality that Layabout still provides that aren't available with the official slackclient library.<ol><li><p>The <code>*</code> event</p> <p>Layabout supported registering a function to trigger on <strong>all</strong> events with <code>@app.handle("*")</code>. This was primarily useful in debugging, but I think you can achieve similar results by setting the logging level to <code>logging.DEBUG</code>.</p><li><p>Auto-loading environment variables</p> <p>Dealing with credentials is always a pain in the butt, so I designed Layabout to automatically load the Slack API token from <code>$LAYABOUT_TOKEN</code> by default. Or, with <code>app.run(connector=EnvVar("WHATEVER")</code> you could load the token from <code>$WHATEVER</code> environment variable you pleased.</p><li><p>The run <code>until</code> option</p> <p>With Layabout you could use <code>app.run(until=...)</code> to provide an arbitary function which would trigger an exit from the application's core loop. I added this to enable cleaner testing with fewer mocks. However, bots are usually meant to be long-running applications, so I'm not sure this was ever useful enough to justify its existence.</p></ol><p>These are all handy features, but I don't think any of them are consequential enough to be worth keeping Layabout around. If, going forward, you miss these features, they're probably better suited to be suggestions or pull requests to the official library now.<h2 id=thanks><a aria-label="Anchor link for: thanks" href=#thanks></a>Thanks</h2><p>If you used Layabout, <em>thank you</em>. I hope you got as much joy out of it as a user as I got in writing it. I would also like to thank these fine folks for their contributions in getting Layabout off the ground and helping maintain it.<ul><li>Alex LordThorsen (<a href=https://github.com/rawrgulmuffins>@rawrgulmuffins</a>)<li>Geoff Shannon (<a href=https://github.com/RadicalZephyr>@RadicalZephyr</a>)<li>Kyle Rader (<a href=https://github.com/kyle-rader>@kyle-rader</a>)<li>Mike Canoy (<a href=https://github.com/mikecanoy>@mikecanoy</a>)<li>Sophie Anderson (<a href=https://github.com/SophieKAn>@SophieKAn</a>)</ul></article></main><footer><nav><a href=/>Home</a> â¬¡ <a href=/posts>Posts</a> â¬¡ <a href=/tags>Tags</a> â¬¡ <a href=/contact>Contact</a></nav><p>Â© 2024 Ali Ahmadi â¬¡ <a href=https://github.com/AliiAhmadi>Github</a></footer>